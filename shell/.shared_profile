#!/bin/bash
# Shared profile configuration for both bash and zsh
# This file contains common environment setup for consistent behavior across shells

# Environment Variables (consistent across shells)
export EDITOR='code'
export VISUAL='code'
export PATH="$HOME/.local/bin:$PATH"

# Homebrew (platform-specific paths)
if [[ -f "/opt/homebrew/bin/brew" ]]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
elif [[ -f "/home/linuxbrew/.linuxbrew/bin/brew" ]]; then
    eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
fi

# Python via pyenv (manually configured)
export PYENV_ROOT="$HOME/.pyenv"
command -v pyenv >/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init -)"

# Node.js via NVM
export NVM_DIR="$HOME/.nvm"
[[ -s "$NVM_DIR/nvm.sh" ]] && source "$NVM_DIR/nvm.sh"
[[ -s "$NVM_DIR/bash_completion" ]] && source "$NVM_DIR/bash_completion"


# SDKMAN (with proper error handling for both shells)
export SDKMAN_DIR="$HOME/.sdkman"
if [[ -s "$HOME/.sdkman/bin/sdkman-init.sh" ]]; then
    # Source SDKMAN with proper error handling
    if ! source "$HOME/.sdkman/bin/sdkman-init.sh" 2>/dev/null; then
        echo "Warning: SDKMAN initialization failed, attempting to fix..." >&2
        
        # Check if SDKMAN directory structure is correct
        if [[ ! -d "$SDKMAN_DIR/ext" ]]; then
            mkdir -p "$SDKMAN_DIR/ext"
            echo "Created missing SDKMAN ext directory" >&2
        fi
        
        # Try sourcing again
        source "$HOME/.sdkman/bin/sdkman-init.sh" 2>/dev/null || {
            echo "SDKMAN initialization failed permanently - please reinstall SDKMAN" >&2
        }
    fi
fi

# Shared functions
mkcd() {
    mkdir -p "$1" && cd "$1"
}

# Git shortcuts (consistent function syntax for both shells)
function gst() {
    git status
}

function gco() {
    git checkout "$@"
}

function gpl() {
    git pull
}

function gps() {
    git push
}

# Quick navigation aliases
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'

# Development aliases
alias ll='ls -la'
alias la='ls -A'
alias l='ls -CF'

# Helper function for welcome message
show_welcome() {
    cat << "EOF"
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⣧⣼⣧⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣭⣭⣤⣄⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⣿⣿⣿⣿⣿⣷⣤⣤⡄
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⡿⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣼⣿⣮⣍⣉⣉⣀⣀⠀⠀⠀
⠀⠀⣠⣶⣶⣶⣶⣶⣶⣶⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⠀⠀
⣴⣿⣿⣿⣿⣿⣯⡛⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀
⠉⣿⣿⣿⣿⣿⣿⣷⠘⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠏⠀⠀
⠀⣿⣿⣿⣿⣿⣿⡟⠸⠿⠿⠿⣿⣿⣿⣿⣿⣿⣿⠿⠋⠀⠀⠀
⠀⠘⢿⣿⣿⠿⠋⠀⠀⠀⠀⠀⠀⠉⠉⣿⣿⡏⠁⠀⠀⠀⠀⠀
⠀⠀⢸⣿⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⡇⠀⠀⠀⠀⠀⠀
EOF
    echo "Welcome back, Matty!"
}

###### FINISH ######
